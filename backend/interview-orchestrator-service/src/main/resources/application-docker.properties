# =========================================
# DOCKER ENVIRONMENT CONFIGURATION
# =========================================
# This profile is used when running in Docker containers

# =========================================
# SERVER
# =========================================
server.port=8081
server.servlet.context-path=/api/interview

# =========================================
# MYSQL DATABASE - Docker Container  
# =========================================
spring.datasource.url=jdbc:mysql://${MYSQL_INTERVIEW_HOST:mysql-interview}:${MYSQL_INTERVIEW_PORT:3307}/${MYSQL_INTERVIEW_DATABASE:interview_orchestrator_db}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=${MYSQL_INTERVIEW_USER:interview_mgmt}
spring.datasource.password=${MYSQL_INTERVIEW_PASSWORD:StrongPassword123}

# Connection pool settings for production
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.connection-timeout=60000

# JPA
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=${JPA_FORMAT_SQL:false}

# =========================================
# FLYWAY MIGRATIONS
# =========================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# =========================================
# REDIS SESSION MANAGEMENT
# =========================================
spring.redis.host=${REDIS_HOST:redis}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.timeout=2000ms
spring.redis.database=1
# Connection pool settings
spring.redis.jedis.pool.max-active=20
spring.redis.jedis.pool.max-idle=10
spring.redis.jedis.pool.min-idle=2
spring.redis.jedis.pool.max-wait=-1ms

# =========================================
# EXTERNAL SERVICES
# =========================================
# AI Analytics Service (FastAPI)
app.services.ai-analytics.url=${AI_ANALYTICS_URL:http://ai-analytics:8003}
app.services.ai-analytics.timeout=30s

# Adaptive Question Engine (FastAPI)
app.services.adaptive-engine.url=${ADAPTIVE_ENGINE_URL:http://adaptive-engine:8001}
app.services.adaptive-engine.timeout=15s

# Speech & Transcript Service (FastAPI)
app.services.speech-service.url=${SPEECH_SERVICE_URL:http://speech-service:8002}
app.services.speech-service.websocket.url=${SPEECH_WEBSOCKET_URL:ws://speech-service:8002}

# User Management Service (Spring Boot)
app.services.user-management.url=${USER_MANAGEMENT_URL:http://user-management-service:8080}

# =========================================
# WEBRTC CONFIGURATION
# =========================================
# Daily.co configuration
app.webrtc.daily.api-key=${DAILY_API_KEY:your_daily_api_key_here}
app.webrtc.daily.domain=${DAILY_DOMAIN:your_daily_domain.daily.co}
app.webrtc.session.timeout=7200
app.webrtc.ice-servers[0]=stun:stun.l.google.com:19302
app.webrtc.ice-servers[1]=turn:relay1.daily.co:3478
app.webrtc.ice-servers[2]=turn:relay1.daily.co:443

# =========================================
# INTERVIEW CONFIGURATION
# =========================================
# IRT Parameters
app.interview.irt.initial-theta=${IRT_INITIAL_THETA:0.0}
app.interview.irt.initial-standard-error=${IRT_INITIAL_SE:1.0}
app.interview.irt.confidence-threshold=${IRT_CONFIDENCE_THRESHOLD:0.3}
app.interview.irt.min-questions=${IRT_MIN_QUESTIONS:10}
app.interview.irt.max-questions=${IRT_MAX_QUESTIONS:30}

# Interview Session Management
app.interview.session.max-duration-minutes=${SESSION_MAX_DURATION:120}
app.interview.session.idle-timeout-minutes=${SESSION_IDLE_TIMEOUT:15}
app.interview.session.auto-save-interval-seconds=${SESSION_AUTOSAVE_INTERVAL:30}

# =========================================
# WEBSOCKET CONFIGURATION
# =========================================
app.websocket.allowed-origins=${WEBSOCKET_ALLOWED_ORIGINS:http://localhost:4200,http://frontend:4200,https://localhost:4200,https://frontend:4200}
app.websocket.session-timeout=${WEBSOCKET_SESSION_TIMEOUT:1800000}
app.websocket.heartbeat-interval=${WEBSOCKET_HEARTBEAT_INTERVAL:30000}

# =========================================
# CORS CONFIGURATION
# =========================================
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:4200,http://frontend:4200}
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# =========================================
# JWT INTEGRATION
# =========================================
app.jwt.secret=${JWT_SECRET:kV7pL9zR3mX1tU5qW8bC2yJ6fH4nE0sD}
app.jwt.expiry-ms=${JWT_EXPIRY_MS:3600000}

# =========================================
# LOGGING
# =========================================
logging.level.org.springframework=${SPRING_LOG_LEVEL:INFO}
logging.level.com.company=${APP_LOG_LEVEL:DEBUG}
logging.level.org.flywaydb=${FLYWAY_LOG_LEVEL:INFO}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log to file in Docker container
logging.file.name=/app/logs/interview-orchestrator-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.total-size-cap=100MB

# =========================================
# ACTUATOR (Health Checks & Monitoring)
# =========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=true
management.endpoint.prometheus.enabled=true

# Health check details
management.health.redis.enabled=true
management.health.db.enabled=true
management.health.diskspace.enabled=true

# =========================================
# SECURITY HEADERS
# =========================================
server.servlet.session.cookie.secure=${COOKIE_SECURE:false}
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=lax

# =========================================
# PERFORMANCE TUNING
# =========================================
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=15000

# =========================================
# ERROR HANDLING
# =========================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false

# =========================================
# INTERVIEW ANALYTICS
# =========================================
app.analytics.batch-size=${ANALYTICS_BATCH_SIZE:100}
app.analytics.processing-timeout=${ANALYTICS_TIMEOUT:60}
app.analytics.retry-attempts=${ANALYTICS_RETRY_ATTEMPTS:3}

# =========================================
# FILE UPLOAD CONFIGURATION
# =========================================
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:50MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:50MB}
spring.servlet.multipart.enabled=true
