# =========================================
# RAILWAY PROFILE - USER MANAGEMENT SERVICE
# =========================================

# SERVER - Railway automatically sets PORT
server.port=${PORT:8080}
server.servlet.context-path=/api/auth

# RAILWAY DATABASE CONFIGURATION (Auto-detects PostgreSQL/MySQL)
spring.datasource.url=${DATABASE_URL}
spring.datasource.driver-class-name=${DB_DRIVER:org.postgresql.Driver}
spring.datasource.username=${DB_USERNAME:${PGUSER:${MYSQLUSER:postgres}}}
spring.datasource.password=${DB_PASSWORD:${PGPASSWORD:${MYSQLPASSWORD}}}

# Alternative fallback to Supabase if Railway DB not available
spring.datasource.url=${DATABASE_URL:postgresql://postgres:CoolLife@AriaDB@db.deqfzxsmuydhrepyiagq.supabase.co:5432/postgres}

# Connection Pool Settings optimized for Railway
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000

# JPA Configuration - Auto-detect dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=${HIBERNATE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.database-platform=${HIBERNATE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}

# FLYWAY MIGRATIONS - ENABLED for Railway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration/postgresql,classpath:db/migration/mysql
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=false

# REDIS CONFIGURATION - Railway Redis or fallback to Upstash
spring.redis.url=${REDIS_URL:redis://renewing-falcon-41265.upstash.io:6379}
spring.redis.password=${REDIS_PASSWORD:AaExAAIncDE3NTczYWIxNDNjYjA0NzI2YWQ2NmY0ZTZjZTg5Y2IyMXAxNDEyNjU}
spring.redis.timeout=2000ms
spring.redis.database=0

# JWT CONFIG
app.jwt.secret=${JWT_SECRET:kV7pL9zR3mX1tU5qW8bC2yJ6fH4nE0sDmA3gK9xZ2vF8uQ4tY7rP1wE6iO5sL0hN}
app.jwt.expiry-ms=${JWT_EXPIRY_MS:3600000}
app.jwt.refresh-expiry-ms=${JWT_REFRESH_EXPIRY_MS:604800000}
app.jwt.issuer=${JWT_ISSUER:ARIA-Railway}

# MAIL CONFIGURATION
spring.mail.host=${SMTP_HOST:smtp.gmail.com}
spring.mail.port=${SMTP_PORT:587}
spring.mail.username=${SMTP_USERNAME:workwithrvprajwal@gmail.com}
spring.mail.password=${SMTP_PASSWORD:vclhowpwtmopdqdz}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.default-encoding=UTF-8

# MULTIPART FILE UPLOAD
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=20MB
spring.servlet.multipart.enabled=true

# LOGGING - Optimized for Railway
logging.level.org.springframework=INFO
logging.level.com.company=INFO
logging.level.root=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# SECURITY HEADERS
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=lax

# ACTUATOR - Railway compatible
management.endpoints.web.exposure.include=health,metrics
management.endpoint.health.show-details=always
management.security.enabled=false

# CORS - Allow Railway domains
app.cors.allowed-origins=${CORS_ORIGINS:*}
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# Railway-specific optimizations
server.forward-headers-strategy=framework
server.tomcat.remote-ip-header=x-forwarded-for
server.tomcat.protocol-header=x-forwarded-proto

# Environment detection
environment=${RAILWAY_ENVIRONMENT:railway}
