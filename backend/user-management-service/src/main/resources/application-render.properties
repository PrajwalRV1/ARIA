# ==========================================
# RENDER OPTIMIZED CONFIGURATION
# ==========================================
# Ultra-fast startup configuration for Render deployment
# Health check ready in under 30 seconds

# ==========================================
# SERVER CONFIGURATION (Match interview-orchestrator)
# ==========================================
server.port=${PORT:10000}
server.address=0.0.0.0
server.servlet.context-path=/api/auth

# ==========================================
# DATABASE - POSTGRESQL (NEON)
# ==========================================
# Neon serverless PostgreSQL - No connection limits!
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://ep-muddy-truth-ad583n4q-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&ApplicationName=ARIA-User-Management}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=${DB_USERNAME:neondb_owner}
spring.datasource.password=${DB_PASSWORD:npg_SxyCtjKD16EU}

# Neon-optimized connection pool for Render
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# Enable prepared statements (Neon supports them with full compatibility)
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true
spring.datasource.hikari.data-source-properties.prepareThreshold=3
spring.datasource.hikari.data-source-properties.preparedStatementCacheSize=256

# ==========================================
# JPA/HIBERNATE - OPTIMIZED FOR FAST STARTUP
# ==========================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=${SPRING_JPA_DATABASE_PLATFORM:org.hibernate.dialect.PostgreSQLDialect}
spring.jpa.defer-datasource-initialization=${SPRING_JPA_DEFER_DATASOURCE_INITIALIZATION:true}
spring.jpa.open-in-view=false

# PostgreSQL enum handling configuration (CRITICAL for enum casting fix)
spring.jpa.properties.hibernate.type.preferred_uuid_jdbc_type=CHAR
spring.jpa.properties.hibernate.globally_quoted_identifiers=false

# Fast startup optimizations
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# JPA/Hibernate performance tuning
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Disable second-level cache to avoid JCache dependency issues
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# ==========================================
# FLYWAY MIGRATIONS
# ==========================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=false

# ==========================================
# ACTUATOR - HEALTH CHECK OPTIMIZATION
# ==========================================
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized
management.endpoints.web.base-path=/actuator
management.endpoint.health.probes.enabled=true

# Disable slow health checks
management.health.redis.enabled=false
management.health.diskspace.enabled=false
management.health.mail.enabled=false
management.health.db.enabled=true
management.health.ping.enabled=true

# ==========================================
# REDIS (IF USED) - OPTIONAL
# ==========================================
spring.redis.host=${UPSTASH_REDIS_HOST:}
spring.redis.port=${UPSTASH_REDIS_PORT:6379}
spring.redis.password=${UPSTASH_REDIS_PASSWORD:}
spring.redis.ssl.enabled=true
spring.redis.timeout=2000ms

# ==========================================
# JWT CONFIGURATION
# ==========================================
app.jwt.secret=${JWT_SECRET:kV7pL9zR3mX1tU5qW8bC2yJ6fH4nE0sDmA3gK9xZ2vF8uQ4tY7rP1wE6iO5sL0hNjK2mN6sP8tB5xD9fG3hA7eQ1uW4rT0yI6oL2zA5cF8vM1nK4jH7gE9xS}
app.jwt.expiry-ms=3600000

# ==========================================
# LOGGING - MINIMAL FOR FAST STARTUP
# ==========================================
logging.level.org.springframework=WARN
logging.level.com.company.user=INFO
logging.level.org.hibernate=WARN
logging.level.org.springframework.security=WARN
logging.level.org.flywaydb=INFO
logging.level.ch.qos.logback=WARN
logging.level.org.springframework.boot=WARN
logging.level.org.springframework.boot.autoconfigure=WARN

# ==========================================
# MAIL (OPTIONAL)
# ==========================================
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}

# ==========================================
# CORS CONFIGURATION FOR RENDER DEPLOYMENT
# ==========================================
cors.allowed-origins=${CORS_ORIGINS:https://aria-frontend-tc4z.onrender.com}

# ==========================================
# SECURITY HEADERS
# ==========================================
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# ==========================================
# PERFORMANCE OPTIMIZATIONS
# ==========================================
# Enable gzip compression
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css
server.compression.min-response-size=1024

# HTTP/2 support
server.http2.enabled=true

# Jackson JSON optimization
spring.jackson.default-property-inclusion=NON_NULL
spring.jackson.serialization.write_dates_as_timestamps=false
