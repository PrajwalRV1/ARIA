# =========================================
# RENDER PROFILE - PRODUCTION DEPLOYMENT - MINIMAL STARTUP
# =========================================

# SERVER CONFIGURATION - Render Port Binding (CRITICAL)
server.port=${PORT:10000}
server.address=0.0.0.0
# REMOVE CONTEXT PATH for Render - allows health checks at root level
# server.servlet.context-path=/api/auth

# DISABLE SSL (Render handles SSL termination)
server.ssl.enabled=false

# FORCE POSTGRESQL DATASOURCE (No H2 fallback)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://aws-1-ap-south-1.pooler.supabase.com:6543/postgres?sslmode=require&ApplicationName=ARIA-User-Management}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=${DB_USERNAME:postgres.deqfzxsmuydhrepyiagq}
spring.datasource.password=${DB_PASSWORD:CoolLife@AriaDB}

# MINIMAL CONNECTION POOL FOR FAST STARTUP
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.initialization-fail-timeout=30000

# JPA CONFIGURATION - FORCE POSTGRESQL FOR RENDER
spring.jpa.hibernate.ddl-auto=none
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=false
spring.jpa.defer-datasource-initialization=false
# CRITICAL: Force PostgreSQL dialect to override any MySQL settings
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.hbm2ddl.auto=none
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.database=postgresql

# DISABLE FLYWAY TO PREVENT STARTUP HANG
spring.flyway.enabled=false

# DISABLE PROBLEMATIC AUTO-CONFIGURATIONS
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration

# JWT CONFIG
app.jwt.secret=${JWT_SECRET:kV7pL9zR3mX1tU5qW8bC2yJ6fH4nE0sDmA3gK9xZ2vF8uQ4tY7rP1wE6iO5sL0hN}
app.jwt.expiry-ms=${JWT_EXPIRY_MS:3600000}
app.jwt.refresh-expiry-ms=${JWT_REFRESH_EXPIRY_MS:604800000}
app.jwt.issuer=${JWT_ISSUER:ARIA-Render}

# MAIL CONFIGURATION
spring.mail.host=${SMTP_HOST:smtp.gmail.com}
spring.mail.port=${SMTP_PORT:587}
spring.mail.username=${SMTP_USERNAME:workwithrvprajwal@gmail.com}
spring.mail.password=${SMTP_PASSWORD:vclhowpwtmopdqdz}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.default-encoding=UTF-8

# MULTIPART FILE UPLOAD - Render optimized
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.enabled=true

# LOGBACK CONFIGURATION - RENDER COMPATIBLE (CONSOLE ONLY)
logging.config=classpath:logback-render.xml

# FORCE CONSOLE LOGGING ONLY - NO FILE APPENDERS
logging.level.org.springframework=INFO
logging.level.org.springframework.boot=INFO
logging.level.org.springframework.boot.web=INFO
logging.level.com.company.user=DEBUG
logging.level.root=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n

# STARTUP PERFORMANCE - Fail fast configurations
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.datasource.hikari.validate-connection-on-borrow=true
spring.datasource.hikari.test-query=SELECT 1

# SECURITY HEADERS - Render production
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# ACTUATOR - CRITICAL FIX: Use separate management server on SAME port
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=false
management.security.enabled=false
# Make Redis health check non-blocking
management.health.redis.enabled=false
management.health.defaults.enabled=true
# CRITICAL: Use separate management server on SAME port but DIFFERENT context
management.server.port=${PORT:10000}
management.server.address=0.0.0.0
management.endpoints.web.base-path=/
management.endpoints.web.path-mapping.health=health

# CORS - Render domains
app.cors.allowed-origins=${CORS_ORIGINS:https://aria-frontend.onrender.com,https://aria-user-management.onrender.com}
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin
app.cors.allow-credentials=true

# Render-specific optimizations
server.forward-headers-strategy=framework
server.tomcat.remote-ip-header=x-forwarded-for
server.tomcat.protocol-header=x-forwarded-proto

# Environment detection
environment=${RENDER_SERVICE_NAME:render}

# Health check endpoint for Render
management.endpoint.health.probes.enabled=true
management.health.readinessstate.enabled=true
management.health.livenessstate.enabled=true
