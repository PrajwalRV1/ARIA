<!-- Minor HTML updates for improved alignment and responsive behavior -->

<div class="dashboard-root">
  <!-- Header / Title -->
  <div class="dashboard-header">
    <h1>
      <i class="fas fa-users"></i>
      Upcoming Interview Candidate Details
    </h1>

    <!-- Top Tabs / Nav -->
    <div class="top-tabs">
      <button
        *ngFor="let t of tabs"
        class="tab"
        [class.active]="activeTab === t.key"
        (click)="
          t.key === 'upload' 
            ? openAddCandidate() 
            : t.key === 'schedule' 
              ? goToQuestionBank() 
              : setActiveTab(t.key)
        "
      >
        <i [class]="t.icon"></i>
        <span>{{ t.label }}</span> <!-- Wrapped label in span for better control -->
      </button>
    </div>
  </div>

  <!-- Main content area -->
  <div class="dashboard-content">
    <!-- Left column: candidate cards -->
    <div class="left-col">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-spinner">
        <div class="spinner"></div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && candidates.length === 0" class="empty-state">
        <i class="fas fa-user-slash"></i>
        <h3>No Candidates Found</h3>
        <p>Start by adding candidates or uploading resumes to begin the interview process.</p>
      </div>

      <!-- Candidate Cards -->
      <div *ngIf="!isLoading && candidates.length > 0" class="cards-wrapper">
        <div
          *ngFor="let card of candidates; let i = index"
          class="candidate-card"
          [class.card-active]="card.active"
          [style.animation-delay]="(i * 0.1) + 's'"
          (click)="selectCard(card)"
        >
          <div class="card-content">
            <div class="card-left">
              <div class="avatar-wrapper">
                <div class="avatar">
                  {{ getInitials(card.name) }}
                </div>
                <div class="status-indicator" 
                     [class]="getStatusClass(card.status)"
                     [title]="'Status: ' + card.status">
                </div>
              </div>
            </div>

            <div class="card-main">
              <div class="card-row top">
                <div class="name-group">
                  <span class="candidate-name">{{ card.name }}</span>
                  <span class="requisition">
                    <i class="fas fa-id-badge"></i>
                    <span>Requisition ID: {{ card.requisitionId }}</span>
                  </span>
                </div>

                <div class="actions">
                  <a class="view" (click)="openEditCandidate(card); $event.stopPropagation();">
                    <i class="fas fa-edit"></i>
                    <span>View & edit details</span>
                  </a>
                  <span class="eye" title="Preview" (click)="openEditCandidate(card); $event.stopPropagation();">
                    <i class="fas fa-eye"></i>
                  </span>
                </div>
              </div>

              <div class="card-row middle">
                <div class="job-title">
                  <i class="fas fa-briefcase"></i>
                  <span>{{ card.jobTitle }}</span>
                </div>
                <div class="spacer"></div>
                <div class="status-block" (click)="$event.stopPropagation()">
                  <!-- Interview Round Dropdown -->
                  <div class="dropdown-group">
                    <label class="dropdown-label">Round:</label>
                    <select
                      class="round-select"
                      [value]="card.interviewRound || ''"
                      (change)="onInterviewRoundChange(card, $event)"
                      [disabled]="isUpdatingCandidate(card.id)"
                      [title]="isUpdatingCandidate(card.id) ? 'Updating...' : 'Select interview round'"
                    >
                      <option value="" [selected]="!card.interviewRound">Select Round</option>
                      <option 
                        *ngFor="let round of interviewRounds" 
                        [value]="round"
                        [selected]="card.interviewRound === round"
                      >
                        {{ round }}
                      </option>
                    </select>
                    <span *ngIf="isUpdatingCandidate(card.id)" class="updating-indicator">
                      <i class="fas fa-spinner fa-spin"></i>
                    </span>
                  </div>
                  
                  <!-- Status Dropdown -->
                  <div class="dropdown-group">
                    <label class="dropdown-label">Status:</label>
                    <select
                      class="status-select"
                      [value]="card.status"
                      (change)="onStatusChange(card, $event)"
                      [disabled]="isUpdatingCandidate(card.id)"
                      [title]="isUpdatingCandidate(card.id) ? 'Updating...' : 'Select status'"
                    >
                      <option 
                        *ngFor="let status of statusOptions" 
                        [value]="status"
                        [selected]="card.status === status"
                      >
                        {{ getStatusLabel(status) }}
                      </option>
                    </select>
                    <span *ngIf="isUpdatingCandidate(card.id)" class="updating-indicator">
                      <i class="fas fa-spinner fa-spin"></i>
                    </span>
                  </div>
                  
                  <button class="tiny-icon" 
                          (click)="openAudioUpload(card); $event.stopPropagation();" 
                          title="Upload Phone Screening Audio">
                    <i class="fas fa-microphone"></i>
                  </button>
                </div>
              </div>

              <div class="card-row bottom">
                <div class="experience">
                  <i class="fas fa-user-graduate"></i>
                  <span>{{ card.experience }}</span>
                </div>
                <div class="feedback">
                  <a (click)="openFeedback(card); $event.stopPropagation()">
                    <i class="fas fa-comments"></i>
                    <span>Interview Feedback</span>
                  </a>
                  <button class="small-feedback" 
                          (click)="openFeedback(card); $event.stopPropagation()"
                          title="View Feedback">
                    <i class="fas fa-file-alt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right column: actions / info -->
    <div class="right-col">
      <!-- Quick Actions Block -->
      <div class="right-block actions-block">
        <h3>
          <i class="fas fa-bolt"></i>
          Quick Actions
        </h3>
        <button class="full add-candidate" (click)="openAddCandidate()">
          <i class="fas fa-user-plus"></i>
          <span>Add Candidate</span>
        </button>
        <button class="full bulk-upload" (click)="quickAction('bulk-upload')">
          <i class="fas fa-upload"></i>
          <span>Bulk Upload</span>
        </button>
        <button 
          class="full schedule-interview" 
          (click)="goToQuestionBank()"
          [disabled]="!selectedCandidateForInterview"
          [title]="selectedCandidateForInterview ? 'Go to Question Bank for ' + selectedCandidateForInterview.name : 'Select a candidate first'"
        >
          <i class="fas fa-question-circle"></i>
          <span>Schedule Interview</span>
        </button>
      </div>

      <!-- Statistics Block - Enhanced structure for better alignment -->
      <div class="right-block stats-block">
        <h3>
          <i class="fas fa-chart-bar"></i>
          Statistics
        </h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number">{{ getTotalCandidates() }}</div>
            <div class="stat-label">Total Candidates</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ getPendingInterviews() }}</div>
            <div class="stat-label">Pending Interviews</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ getCompletedInterviews() }}</div>
            <div class="stat-label">Completed</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ getHiredCandidates() }}</div>
            <div class="stat-label">Hired</div>
          </div>
        </div>
      </div>

      <!-- Notes / Info Block -->
      <div class="right-block info-block">
        <h3>
          <i class="fas fa-sticky-note"></i>
          Quick Guide
        </h3>
        <div class="info-content">
          <div class="tip">
            <i class="fas fa-lightbulb"></i>
            <p>Click on candidate cards to view detailed information and update their status.</p>
          </div>
          <div class="tip">
            <i class="fas fa-mouse-pointer"></i>
            <p>Use the dropdown menus to quickly update interview stages.</p>
          </div>
          <div class="tip">
            <i class="fas fa-calendar-alt"></i>
            <p>Schedule interviews directly from the candidate cards.</p>
          </div>
        </div>
      </div>

      <!-- Recent Activity Block -->
      <div class="right-block activity-block" *ngIf="recentActivities && recentActivities.length > 0">
        <h3>
          <i class="fas fa-clock"></i>
          Recent Activity
        </h3>
        <div class="activity-list">
          <div *ngFor="let activity of recentActivities.slice(0, 5)" class="activity-item">
            <div class="activity-icon">
              <i [class]="activity.icon"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">{{ activity.text }}</div>
              <div class="activity-time">{{ activity.time | date:'short' }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Candidate popup (Add or Edit) -->
<app-add-candidate-popup
  [visible]="showAddCandidatePopup"
  [mode]="popupMode"
  [candidateData]="selectedCandidate"
  (close)="closeAddCandidatePopup()"
  (save)="onCandidateSaved($event)"
></app-add-candidate-popup>

<!-- Audio Upload Modal -->
<app-audio-upload-modal
  [visible]="showAudioUploadModal"
  [candidate]="audioUploadCandidate"
  (close)="closeAudioUpload()"
  (upload)="onAudioUpload($event)"
></app-audio-upload-modal>

<!-- Enhanced Confirmation Modal -->
<div *ngIf="showConfirmation" class="modal-overlay" (click)="closeConfirmation()">
  <div class="confirmation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-question-circle"></i>
        Confirm Action
      </h3>
    </div>
    <div class="modal-body">
      <p>{{ confirmationMessage }}</p>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="closeConfirmation()">Cancel</button>
      <button class="btn-confirm" (click)="confirmAction()">Confirm</button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div *ngIf="isProcessing" class="loading-overlay">
  <div class="loading-content">
    <div class="spinner-large"></div>
    <p>Processing...</p>
  </div>
</div>

<app-audio-upload-modal
  [visible]="showAudioUploadModal"
  [candidate]="audioUploadCandidate"
  [candidateName]="audioUploadCandidate?.name || ''"
  [candidateId]="audioUploadCandidate?.id ?? null"
  (close)="closeAudioUpload()"
  (upload)="onAudioUpload($event)">
</app-audio-upload-modal>
